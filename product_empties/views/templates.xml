<?xml version="1.0" encoding="UTF-8"?>
<odoo>
    <template id="website_sale.cart_lines">
        <div t-if="not website_sale_order or not website_sale_order.website_order_line" class="js_cart_lines alert alert-info">Your cart is empty!</div>
        <table class="mb16 table table-striped table-sm js_cart_lines" id="cart_products" t-if="website_sale_order and website_sale_order.website_order_line">
            <thead>
                <tr>
                    <th class="td-img">Product</th>
                    <th />
                    <th class="text-center td-price">Price</th>
                    <th class="text-center td-qty">Quantity</th>
                    <th class="text-center td-price">Subtotal</th>
                    <th class="text-center td-action" />
                </tr>
            </thead>
            <tbody>
                <t t-foreach="website_sale_order.website_order_line" t-as="line">
                    <tr t-if="not line.product_id.is_empty" t-att-class="'optional_product info' if line.linked_line_id else None">
                        <td colspan="2" t-if="not line.product_id.product_tmpl_id" class="td-img" />
                        <td align="center" t-if="line.product_id.product_tmpl_id" class="td-img">
                            <span t-field="line.product_id.image_small" t-options="{'widget': 'image', 'class': 'rounded'}" />
                        </td>
                        <td t-if="line.product_id.product_tmpl_id" class="td-product_name">
                            <div>
                                <t t-call="website_sale.cart_line_product_link">
                                    <strong t-field="line.name_short" />
                                </t>
                            </div>
                            <t t-call="website_sale.cart_line_description_following_lines">
                                <t t-set="div_class" t-value="'d-none d-md-block'" />
                            </t>
                        </td>
                        <td class="text-center td-price" name="price">
                            <t t-set="combination" t-value="line.product_id.product_template_attribute_value_ids + line.product_no_variant_attribute_value_ids" />
                            <t t-set="combination_info" t-value="line.product_id.product_tmpl_id._get_combination_info(combination)" />
                            <t t-set="list_price_converted" t-value="website.currency_id._convert(combination_info['list_price'], website_sale_order.currency_id, website_sale_order.company_id, date)" />
                            <t groups="account.group_show_line_subtotals_tax_excluded" t-if="(website_sale_order.pricelist_id.discount_policy == 'without_discount' and website_sale_order.currency_id.compare_amounts(list_price_converted, line.price_reduce_taxexcl) == 1) or website_sale_order.currency_id.compare_amounts(line.price_unit, line.price_reduce) == 1" name="order_line_discount">
                                <del t-attf-class="#{'text-danger mr8'}" style="white-space: nowrap;" t-esc="list_price_converted" t-options="{'widget': 'monetary', 'display_currency': website_sale_order.currency_id}" />
                            </t>
                            <span t-field="line.price_reduce_taxexcl" style="white-space: nowrap;" t-options="{'widget': 'monetary', 'display_currency': website_sale_order.currency_id}" groups="account.group_show_line_subtotals_tax_excluded" />
                            <t groups="account.group_show_line_subtotals_tax_included" t-if="(website_sale_order.pricelist_id.discount_policy == 'without_discount' and website_sale_order.currency_id.compare_amounts(list_price_converted, line.price_reduce_taxinc) == 1) or website_sale_order.currency_id.compare_amounts(line.price_unit, line.price_reduce) == 1" name="order_line_discount">
                                <del t-attf-class="#{'text-danger mr8'}" style="white-space: nowrap;" t-esc="list_price_converted" t-options="{'widget': 'monetary', 'display_currency': website_sale_order.currency_id}" />
                            </t>
                            <span t-field="line.price_reduce_taxinc" style="white-space: nowrap;" t-options="{'widget': 'monetary', 'display_currency': website_sale_order.currency_id}" groups="account.group_show_line_subtotals_tax_included" />
                        </td>
                        <td class="text-center td-qty">
                            <div t-if="not line.linked_line_id" class="css_quantity input-group mx-auto oe_website_spinner">
                                <div class="input-group-prepend">
                                    <a t-attf-href="#" class="btn btn-link js_add_cart_json d-none d-md-inline-block" aria-label="Remove one" title="Remove one">
                                        <i class="fa fa-minus" />
                                    </a>
                                </div>
                                <input type="text" t-attf-class="js_quantity form-control quantity {{ 'alert-danger' if line.product_id.min_order_qty &gt; line.product_uom_qty else '' }}" t-att-data-line-id="line.id" t-att-data-product-id="line.product_id.id" t-att-value="int(line.product_uom_qty) == line.product_uom_qty and int(line.product_uom_qty) or line.product_uom_qty" />
                                <div class="input-group-append">
                                    <a t-attf-href="#" class="btn btn-link float_left js_add_cart_json d-none d-md-inline-block" aria-label="Add one" title="Add one">
                                        <i class="fa fa-plus" />
                                    </a>
                                </div>
                            </div>
                            <t t-if="line.linked_line_id">
                                <span class="js_quantity text-muted" t-att-data-line-id="line.id" t-att-data-product-id="line.product_id.id" t-esc="int(line.product_uom_qty)" />
                            </t>
                        </td>
                        <td>
                            <t groups="account.group_show_line_subtotals_tax_excluded" t-if="(website_sale_order.pricelist_id.discount_policy == 'without_discount' and website_sale_order.currency_id.compare_amounts(list_price_converted, line.price_reduce_taxexcl) == 1) or website_sale_order.currency_id.compare_amounts(line.price_unit, line.price_reduce) == 1" name="order_line_discount">
                                <del t-attf-class="#{'text-danger mr8'}" style="white-space: nowrap;" t-esc="list_price_converted * line.product_uom_qty" t-options="{'widget': 'monetary', 'display_currency': website_sale_order.currency_id}" />
                            </t>
                            <span t-field="line.price_reduce_taxexcl" style="white-space: nowrap;" t-options="{'widget': 'monetary', 'display_currency': website_sale_order.currency_id}" groups="account.group_show_line_subtotals_tax_excluded" />
                            <t groups="account.group_show_line_subtotals_tax_included" t-if="(website_sale_order.pricelist_id.discount_policy == 'without_discount' and website_sale_order.currency_id.compare_amounts(list_price_converted, line.price_reduce_taxinc) == 1) or website_sale_order.currency_id.compare_amounts(line.price_unit, line.price_reduce) == 1" name="order_line_discount">
                                <del t-attf-class="#{'text-danger mr8'}" style="white-space: nowrap;" t-esc="list_price_converted * line.product_uom_qty" t-options="{'widget': 'monetary', 'display_currency': website_sale_order.currency_id}" />
                            </t>
                            <span t-esc="line.price_reduce_taxinc * line.product_uom_qty" style="white-space: nowrap;" t-options="{'widget': 'monetary', 'display_currency': website_sale_order.currency_id}" groups="account.group_show_line_subtotals_tax_included" />
                        </td>
                        <td class="td-action">
                            <a href="#" aria-label="Remove from cart" title="Remove from cart" class="js_delete_product no-decoration">
                                <i class="fa fa-trash-o" />
                            </a>
                        </td>
                    </tr>
                    <tr class="alert-danger" t-if="line.product_id.min_order_qty &gt; line.product_uom_qty">
                        <td />
                        <td class="td-product_name">
                            <b class="min_qty_not_reached">
                                <i class="fa fa-exclamation-triangle" />
                        Minimum order quantity of
                                <span t-esc="line.product_id.min_order_qty" />
                        not reached
                            </b>
                        </td>
                        <td />
                        <td />
                        <td class="td-price" />
                        <td />
                    </tr>
                    <tr t-if="line.empties_price">
                        <td />
                        <td class="td-product_name">
                            <b>Empties</b>
                        </td>
                        <td />
                        <td />
                        <td class="td-price">
                            <span t-field="line.empties_price" style="white-space: nowrap;" t-options="{'widget': 'monetary', 'display_currency': website_sale_order.currency_id}" />
                        </td>
                        <td />
                    </tr>
                </t>
            </tbody>
        </table>
    </template>
    <template id="short_cart_summary_hide_hr" inherit_id="website_sale.short_cart_summary">
        <xpath expr="//h4" position="attributes">
            <attribute name="class" />
        </xpath>
        <xpath expr="//a" position="attributes">
            <attribute name="class">btn btn-secondary float-right d-none d-xl-inline-block checkout-btn</attribute>
        </xpath>
        <xpath expr="//hr" position="replace" />
    </template>
    <template id="cart_summary_hide_products" inherit_id="website_sale.cart_summary">
        <xpath expr="//table[@id='cart_products']" position="replace">
            <h4 class="card-title mt16 text-center">Your order</h4>
        </xpath>
    </template>
    <template id="cart_total_tax_breakdown" inherit_id="website_sale.total">
        <xpath expr="//span[@t-field='website_sale_order.amount_tax']/../../.." position="replace">
            <table class="table text-right">
                <thead>
                    <tr>
                        <th>VAT Category</th>
                        <th>Amount (VAT incl.)</th>
                    </tr>
                </thead>
                <tbody>
                    <t t-set="amount_by_group_sorted" t-value="website_sale_order.amount_by_group.sort(key=lambda x: int(x[0].split('%')[0]), reverse=True)" />
                    <t t-foreach="website_sale_order.amount_by_group" t-as="tax_line">
                        <tr>
                            <td class="text-xl-right noborder">
                                <span t-esc="tax_line[0]" />
                            </td>
                            <td class="text-xl-right noborder">
                                <span t-esc="tax_line[1] + tax_line[2]" t-options="{'widget': 'monetary', 'display_currency': website_sale_order.currency_id}" />
                            </td>
                        </tr>
                    </t>
                </tbody>
                <tfoot>
                    <tr>
                        <td>Total:</td>
                        <td>
                            <span t-esc="website_sale_order.amount_total" t-options="{'widget': 'monetary', 'display_currency': website_sale_order.currency_id}" />
                        </td>
                    </tr>
                </tfoot>
            </table>
        </xpath>
    </template>
    <template id="cart_popover_hide_empties" inherit_id="website_sale.cart_popover">
        <xpath expr="//t[@t-foreach='website_sale_order.website_order_line']" position="replace" />
        <xpath expr="//a[@role='button']" position="replace">
            <a role="button" class="btn btn-primary" href="/shop/cart">View Cart</a>
        </xpath>
    </template>
    <template id="website_sale.cart">
        <t t-call="website.layout">
            <div id="wrap">
                <div class="container oe_website_sale py-2">
                    <div class="row">
                        <div class="col-12">
                            <t t-call="website_sale.wizard_checkout">
                                <t t-set="step" t-value="10" />
                            </t>
                        </div>
                        <div class="col-12 col-xl-8 oe_cart">
                            <div class="row">
                                <div class="col-lg-12">
                                    <div t-if="abandoned_proceed or access_token" class="mt8 mb8 alert alert-info" role="alert">
                                        <!-- abandoned cart choices -->
                                        <t t-if="abandoned_proceed">
                                            <p>Your previous cart has already been completed.</p>
                                            <p t-if="website_sale_order">Please proceed your current cart.</p>
                                        </t>
                                        <t t-if="access_token">
                                            <p>This is your current cart.</p>
                                            <p>
                                                <strong>
                                                    <a t-attf-href="/shop/cart/?access_token=#{access_token}&amp;revive=squash">Click here</a>
                                                </strong>
                                    if you want to restore your previous cart. Your current cart will be replaced with your previous cart.
                                            </p>
                                            <p>
                                                <strong>
                                                    <a t-attf-href="/shop/cart/?access_token=#{access_token}&amp;revive=merge">Click here</a>
                                                </strong>
                                    if you want to merge your previous cart into current cart.
                                            </p>
                                        </t>
                                    </div>
                                    <t t-call="website_sale.cart_lines" />
                                    <div class="clearfix" />
                                    <a role="button" href="/shop" class="btn btn-secondary mb32 d-none d-xl-inline-block">
                                        <span class="fa fa-chevron-left" />
                                        <span class="">Continue Shopping</span>
                                    </a>
                                    <a role="button" t-if="website_sale_order and website_sale_order.website_order_line" class="btn btn-primary float-right checkout-btn" href="/shop/checkout?express=1">
                                        <span class="">Process Checkout</span>
                                        <span class="fa fa-chevron-right" />
                                    </a>

                                    <div class="oe_structure" id="oe_structure_website_sale_cart_1" />
                                </div>
                            </div>
                        </div>
                        <div class="col-12 col-xl-4">
                            <t t-call="website_sale.short_cart_summary" />
                            <div class="d-xl-none mt8">
                                <a role="button" href="/shop" class="btn btn-secondary mb32">
                                    <span class="fa fa-chevron-left" />
                           Continue
                                    <span class="d-none d-md-inline">Shopping</span>
                                </a>

                                <a role="button" t-if="website_sale_order and website_sale_order.website_order_line" class="btn btn-primary float-right checkout-btn" href="/shop/checkout?express=1">
                                    <span class="">Process Checkout</span>
                                    <span class="fa fa-chevron-right" />
                                </a>

                            </div>
                        </div>
                    </div>
                </div>
                <div class="oe_structure" id="oe_structure_website_sale_cart_2" />
            </div>
        </t>
    </template>
    <template id="product_item" inherit_id="website_sale.products_item">
        <xpath expr="//div[@class='product_price']" position="after">
            <small>
                <span t-esc="product.unit_price" t-options="{'widget': 'monetary', 'display_currency': website.currency_id}" /> / <span t-esc="product.unit_uom.name"/>
            </small>
        </xpath>
    </template>
    <template id="product" inherit_id="website_sale.product">
        <xpath expr="//a[@id='add_to_cart']" position="after">
            <div class="row mt16">
                <div class="col-12">
                    <small>
                        <span t-esc="product.unit_price" t-options="{'widget': 'monetary', 'display_currency': website.currency_id}" /> / <span t-esc="product.unit_uom.name"/>
                    </small>
                </div>
            </div>
        </xpath>
    </template>
</odoo>